clear
a1=0.58;a2=4.15;a3=3.83;a4=1.45;b1=0.29;b2=0.42;b3=0.34;b4=0.29;r1=0.08;r2=0.19;r3=0.08;r4=0.03;C1=6.03;C2=8.72;C3=8.39;C4=8.28;D1=0.95;D2=1.07;D3=0.98;D4=1.35;
w1=0;w2=0;w3=0;w4=0;
t=1;D=8;
Q1=zeros(1,30);Q2=zeros(1,30);Q3=zeros(1,30);Q4=zeros(1,30);
X1=[];X2=[];X3=[];X4=[];
P1=[];P2=[];P3=[];P4=[];
PI=[];
while t<=240
    f=@(x)(-...
       ((1/b1)*x(1)*(a1+r1*log(C1*D*w1+D1)-log(x(1))+log(1-x(1)-x(2)-x(3)-x(4)))...
       +(1/b2)*x(2)*(a2+r2*log(C2*D*w2+D2)-log(x(2))+log(1-x(1)-x(2)-x(3)-x(4)))...
       +(1/b3)*x(3)*(a3+r3*log(C3*D*w3+D3)-log(x(3))+log(1-x(1)-x(2)-x(3)-x(4)))...
       +(1/b4)*x(4)*(a4+r4*log(C4*D*w4+D4)-log(x(4))+log(1-x(1)-x(2)-x(3)-x(4)))...
       ));
   x0=[0.01;0.01;0.01;0.01];
   lb=[0;0;0;0];
   ub=[1;1;1;1];
   [xx,fval] = fmincon(f,x0,[],[],[],[],lb,ub);
   Q1=[Q1 xx(1)];
   Q1(1)=[];
   w1=sum(Q1);
   Q2=[Q2 xx(2)];
   Q2(1)=[];
   w2=sum(Q2);
   Q3=[Q3 xx(3)];
   Q3(1)=[];
   w3=sum(Q3);
   Q4=[Q4 xx(4)];
   Q4(1)=[];
   w4=sum(Q4);
   X1=[X1 xx(1)];
   X2=[X2 xx(2)];
   X3=[X3 xx(3)];
   X4=[X4 xx(4)];
   p1=(1/b1)*(a1-log(xx(1))+log(1-xx(1)-xx(2)-xx(3)-xx(4))+r1*log(C1*D*w1+D1));
   p2=(1/b2)*(a2-log(xx(2))+log(1-xx(1)-xx(2)-xx(3)-xx(4))+r2*log(C2*D*w2+D2));
   p3=(1/b3)*(a3-log(xx(3))+log(1-xx(1)-xx(2)-xx(3)-xx(4))+r3*log(C3*D*w3+D3));
   p4=(1/b4)*(a4-log(xx(4))+log(1-xx(1)-xx(2)-xx(3)-xx(4))+r4*log(C4*D*w4+D4));
   P1=[P1 p1];
   P2=[P2 p2];
   P3=[P3 p3];
   P4=[P4 p4];
   pi=p1*D*xx(1)+p2*D*xx(2)+p3*D*xx(3)+p4*D*xx(4);
   PI=[PI pi];
   t=t+1;
end
