clear
a1=0.96;a2=0.60;a3=1.45;b1=0.22;b2=0.29;b3=0.21;r1=0.26;r2=0.39;r3=0.09;C1=2.02;C2=1.49;C3=1.97;D1=1.02;D2=1.04;D3=1.55;
w1=0;w2=0;w3=0;
t=1;D=2;
Q1=zeros(1,30);Q2=zeros(1,30);Q3=zeros(1,30);
X1=[];X2=[];X3=[];
P1=[];P2=[];P3=[];
PI=[];
while t<=150
    f=@(x)(-...
       ((1/b1)*x(1)*(a1+r1*log(C1*D*w1+D1)-log(x(1))+log(1-x(1)-x(2)-x(3)))...
       +(1/b2)*x(2)*(a2+r2*log(C2*D*w2+D2)-log(x(2))+log(1-x(1)-x(2)-x(3)))...
       +(1/b3)*x(3)*(a3+r3*log(C3*D*w3+D3)-log(x(3))+log(1-x(1)-x(2)-x(3)))...
       ));
   x0=[0.01;0.01;0.01];
   lb=[0;0;0];
   ub=[1;1;1];
   [xx,fval] = fmincon(f,x0,[],[],[],[],lb,ub);
   Q1=[Q1 xx(1)];
   Q1(1)=[];
   w1=sum(Q1);
   Q2=[Q2 xx(2)];
   Q2(1)=[];
   w2=sum(Q2);
   Q3=[Q3 xx(3)];
   Q3(1)=[];
   w3=sum(Q3);
   X1=[X1 xx(1)];
   X2=[X2 xx(2)];
   X3=[X3 xx(3)];
   p1=(1/b1)*(a1-log(xx(1))+log(1-xx(1)-xx(2)-xx(3))+r1*log(C1*D*w1+D1));
   p2=(1/b2)*(a2-log(xx(2))+log(1-xx(1)-xx(2)-xx(3))+r2*log(C2*D*w2+D2));
   p3=(1/b3)*(a3-log(xx(3))+log(1-xx(1)-xx(2)-xx(3))+r3*log(C3*D*w3+D3));
   P1=[P1 p1];
   P2=[P2 p2];
   P3=[P3 p3];
   pi=p1*D*xx(1)+p2*D*xx(2)+p3*D*xx(3);
   PI=[PI pi];
   t=t+1;
end
