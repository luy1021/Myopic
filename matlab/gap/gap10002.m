clear
a1=0.85
a2=1.16
a3=3.98
b1=0.06
b2=0.08
b3=0.18
r1=0.12
r2=0.04
r3=0.02
C1=3.96
C2=4.22
C3=6.37
D1=1.00
D2=1.09
D3=1.11
theta=0.0001;
T=270;
D=5;
L=30;
b=[b1,b2,b3];
r=[r1,r2,r3];
bmax=max(b);
bmin=min(b);
rmax=max(r);

f=@(x)(-((x(1)/b1)*(a1+r1*log(C1*((x(1)*r1/b1)*(L+D1/(D*C1)+D2/(D*C2)+D3/(D*C3))/(x(1)*r1/b1+x(2)*r2/b2+x(3)*r3/b3)-(D1/(C1*D)))+D1)-log(x(1))+log(1-x(1)-x(2)-x(3)))...
    +(x(2)/b2)*(a2+r2*log(C2*((x(2)*r2/b2)*(L+D1/(D*C1)+D2/(D*C2)+D3/(D*C3))/(x(1)*r1/b1+x(2)*r2/b2+x(3)*r3/b3)-(D2/(C2*D)))+D2)-log(x(2))+log(1-x(1)-x(2)-x(3)))...
    +(x(3)/b3)*(a3+r3*log(C3*((x(3)*r3/b3)*(L+D1/(D*C1)+D2/(D*C2)+D3/(D*C3))/(x(1)*r1/b1+x(2)*r2/b2+x(3)*r3/b3)-(D3/(C3*D)))+D3)-log(x(3))+log(1-x(1)-x(2)-x(3)))...
    ));
%x(5)=(x(1)*r1/b1)*(L+D1/(D*C1)+D2/(D*C2)+D3/(D*C3)+D4/(D*C4))/(x(1)*r1/b1+x(2)*r2/b2+x(3)*r3/b3+x(4)*r4/b4)-(D1/(C1*D));
%x(6)=(x(2)*r2/b2)*(L+D1/(D*C1)+D2/(D*C2)+D3/(D*C3)+D4/(D*C4))/(x(1)*r1/b1+x(2)*r2/b2+x(3)*r3/b3+x(4)*r4/b4)-(D2/(C2*D));
%x(7)=(x(3)*r3/b3)*(L+D1/(D*C1)+D2/(D*C2)+D3/(D*C3)+D4/(D*C4))/(x(1)*r1/b1+x(2)*r2/b2+x(3)*r3/b3+x(4)*r4/b4)-(D3/(C3*D));
%x(8)=(x(4)*r4/b4)*(L+D1/(D*C1)+D2/(D*C2)+D3/(D*C3)+D4/(D*C4))/(x(1)*r1/b1+x(2)*r2/b2+x(3)*r3/b3+x(4)*r4/b4)-(D4/(C4*D));
%p1=(1/b1)*(a1+r1*log(C1*w1+D1)-log(q1)+log(1-q1-q2-q3-q4));
%p2=(1/b2)*(a2+r2*log(C2*w2+D2)-log(q2)+log(1-q1-q2-q3-q4));
%p3=(1/b3)*(a3+r3*log(C3*w3+D3)-log(q3)+log(1-q1-q2-q3-q4));
%p4=(1/b4)*(a4+r4*log(C4*w4+D4)-log(q4)+log(1-q1-q2-q3-q4));
%f=-(p1*q1+p2*q2+p3*q3+p4*q4);
x0=[0.01;0.01;0.01];
lb=[0;0;0];
ub=[1;1;1];
[xx1,fval2] = fmincon(f,x0,[],[],[],[],lb,ub);
